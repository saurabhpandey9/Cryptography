import numpy as np

def shiftr(s):
    l=[]
    for i,j in enumerate(s):
        a=j[i:] +j[:i]
        l.append(a)
    return l

def mixcol(st):
    s=[]
    for m in range(4):
        temp=[0]*4
        for n in range(4):
            temp[n]=int(st[m][n],16)
        s.append(temp)
    c=[[2,3,1,1],[1,2,3,1],[1,1,2,3],[3,1,1,2]]
    q=[]
    def mult(r):
        r=np.array(r)
        t=np.array(c)
        b=r.dot(t)
        a=[]
        for j in range(4):
            ts=hex(b[j])
            a.append(ts.replace("0x",""))
        return a
    c=np.array(c)
    s=np.array(s)
    for i,j in enumerate(s):
        r=s[:,i]
        #print(r)
        q.append(list(mult(r)))
    print(q)


def Subbyte(state):
    sbtbl=[['63','7c','77','7b','f2','6b','6f','c5','30','01','67','2b','fe','d7','ab','76'],
    ['ca','82','c9','7d','fa','59','47','f0','ad','d4','a2','af','9c','a4','72','c0'],
    ['b7','fd','93','26','36','3f','f7','cc','34','a5','e5','f1','71','d8','31','15'],
    ['04','c7','23','c3','18','96','05','9a','07','12','80','e2','eb','27','b2','75'],
    ['09','83','2c','1a','1b','6e','5a','a0','52','3b','d6','b3','29','e3','2f','84'],
    ['53','d1','00','ed','20','fc','b1','5b','6a','cb','be','39','4a','4c','58','cf'],
    ['d0','ef','aa','fb','43','4d','33','85','45','f9','02','7f','50','3c','9f','a8'],
    ['51','a3','40','8f','92','9d','38','f5','bc','b6','da','21','10','ff','f3','d2'],
    ['cd','0c','13','ec','5f','97','44','17','c4','a7','7e','3d','64','5d','19','73'],
    ['60','81','4f','dc','22','2a','90','88','46','ee','b8','14','de','5e','0b','db'],
    ['e0','32','3a','0a','49','06','24','5c','c2','d3','ac','62','91','95','e4','79'],
    ['e7','c8','37','6d','8d','d5','4e','a9','6c','56','f4','ea','65','7a','ae','08'],
    ['ba','78','25','2e','1c','a6','b4','c6','e8','dd','74','1f','4b','bd','8b','8a'],
    ['70','3e','b5','66','48','03','f6','0e','61','35','57','b9','86','c1','1d','9e'],
    ['e1','f8','98','11','69','d9','8e','94','9b','1e','87','e9','ce','55','28','df'],
    ['8c','a1','89','0d','bf','e6','42','68','41','99','2d','0f','b0','54','bb','16']]
    out_state=[]
    for i in range(4):
        temp=['1']*4
        for j in range(4):
            s=state[i][j]
            l=int(s[0],16);r=int(s[1],16)
            temp[j]=sbtbl[l][r]
        out_state.append(temp)
    return out_state

def sbox(word):
    sbtbl=[['63','7c','77','7b','f2','6b','6f','c5','30','01','67','2b','fe','d7','ab','76'],
    ['ca','82','c9','7d','fa','59','47','f0','ad','d4','a2','af','9c','a4','72','c0'],
    ['b7','fd','93','26','36','3f','f7','cc','34','a5','e5','f1','71','d8','31','15'],
    ['04','c7','23','c3','18','96','05','9a','07','12','80','e2','eb','27','b2','75'],
    ['09','83','2c','1a','1b','6e','5a','a0','52','3b','d6','b3','29','e3','2f','84'],
    ['53','d1','00','ed','20','fc','b1','5b','6a','cb','be','39','4a','4c','58','cf'],
    ['d0','ef','aa','fb','43','4d','33','85','45','f9','02','7f','50','3c','9f','a8'],
    ['51','a3','40','8f','92','9d','38','f5','bc','b6','da','21','10','ff','f3','d2'],
    ['cd','0c','13','ec','5f','97','44','17','c4','a7','7e','3d','64','5d','19','73'],
    ['60','81','4f','dc','22','2a','90','88','46','ee','b8','14','de','5e','0b','db'],
    ['e0','32','3a','0a','49','06','24','5c','c2','d3','ac','62','91','95','e4','79'],
    ['e7','c8','37','6d','8d','d5','4e','a9','6c','56','f4','ea','65','7a','ae','08'],
    ['ba','78','25','2e','1c','a6','b4','c6','e8','dd','74','1f','4b','bd','8b','8a'],
    ['70','3e','b5','66','48','03','f6','0e','61','35','57','b9','86','c1','1d','9e'],
    ['e1','f8','98','11','69','d9','8e','94','9b','1e','87','e9','ce','55','28','df'],
    ['8c','a1','89','0d','bf','e6','42','68','41','99','2d','0f','b0','54','bb','16']]
    tempout=['1']*4
    for i in range(4):
        s=word[i]
        l=int(s[0],16);r=int(s[1],16)
        tempout[i]=sbtbl[l][r]
    return tempout

def prer(state,key):
    outstate=[]
    for i in range(4):
        temp=['1']*4
        for j in range(4):
            ts=hex(int(state[i][j],16)^int(key[i][j],16))
            temp[j]=ts.replace("0x","")
            if len(temp[j])==1:
                temp[j]="0"+temp[j]
        outstate.append(temp)
    return outstate

def ip2state(ip):
    block=[]
    for i in range(0,31,2):
        block.append(ip[i]+ip[i+1])
    state=[]
    for i in range(4):
        temp=['1']*4
        for j in range(4):
            temp[j]=block[i+4*j]
        state.append(temp)
    return state
# s1=[['00','12','0c','08'],
# ['04','04','00','23'],
# ['12','12','13','19'],
# ['14','00','11','19']]
k=[['54','73','20','67'],['68','20','4b','20'],['61','6d','75','45'],['74','79','6e','75']]
msg_hex=input("Enter hex msg: ")
print(mixcol(shiftr(Subbyte(prer(ip2state(msg_hex),k)))))